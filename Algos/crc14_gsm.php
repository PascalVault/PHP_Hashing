<?php
//CRC-14 GSM
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class Hashercrc14_gsm extends HasherBase
{
	protected $FHash;

	protected $Table = array(
	0x0000, 0x202D, 0x2077, 0x005A, 0x20C3, 0x00EE, 0x00B4, 0x2099, 
	0x21AB, 0x0186, 0x01DC, 0x21F1, 0x0168, 0x2145, 0x211F, 0x0132, 
	0x237B, 0x0356, 0x030C, 0x2321, 0x03B8, 0x2395, 0x23CF, 0x03E2, 
	0x02D0, 0x22FD, 0x22A7, 0x028A, 0x2213, 0x023E, 0x0264, 0x2249, 
	0x26DB, 0x06F6, 0x06AC, 0x2681, 0x0618, 0x2635, 0x266F, 0x0642, 
	0x0770, 0x275D, 0x2707, 0x072A, 0x27B3, 0x079E, 0x07C4, 0x27E9, 
	0x05A0, 0x258D, 0x25D7, 0x05FA, 0x2563, 0x054E, 0x0514, 0x2539, 
	0x240B, 0x0426, 0x047C, 0x2451, 0x04C8, 0x24E5, 0x24BF, 0x0492, 
	0x2D9B, 0x0DB6, 0x0DEC, 0x2DC1, 0x0D58, 0x2D75, 0x2D2F, 0x0D02, 
	0x0C30, 0x2C1D, 0x2C47, 0x0C6A, 0x2CF3, 0x0CDE, 0x0C84, 0x2CA9, 
	0x0EE0, 0x2ECD, 0x2E97, 0x0EBA, 0x2E23, 0x0E0E, 0x0E54, 0x2E79, 
	0x2F4B, 0x0F66, 0x0F3C, 0x2F11, 0x0F88, 0x2FA5, 0x2FFF, 0x0FD2, 
	0x0B40, 0x2B6D, 0x2B37, 0x0B1A, 0x2B83, 0x0BAE, 0x0BF4, 0x2BD9, 
	0x2AEB, 0x0AC6, 0x0A9C, 0x2AB1, 0x0A28, 0x2A05, 0x2A5F, 0x0A72, 
	0x283B, 0x0816, 0x084C, 0x2861, 0x08F8, 0x28D5, 0x288F, 0x08A2, 
	0x0990, 0x29BD, 0x29E7, 0x09CA, 0x2953, 0x097E, 0x0924, 0x2909, 
	0x3B1B, 0x1B36, 0x1B6C, 0x3B41, 0x1BD8, 0x3BF5, 0x3BAF, 0x1B82, 
	0x1AB0, 0x3A9D, 0x3AC7, 0x1AEA, 0x3A73, 0x1A5E, 0x1A04, 0x3A29, 
	0x1860, 0x384D, 0x3817, 0x183A, 0x38A3, 0x188E, 0x18D4, 0x38F9, 
	0x39CB, 0x19E6, 0x19BC, 0x3991, 0x1908, 0x3925, 0x397F, 0x1952, 
	0x1DC0, 0x3DED, 0x3DB7, 0x1D9A, 0x3D03, 0x1D2E, 0x1D74, 0x3D59, 
	0x3C6B, 0x1C46, 0x1C1C, 0x3C31, 0x1CA8, 0x3C85, 0x3CDF, 0x1CF2, 
	0x3EBB, 0x1E96, 0x1ECC, 0x3EE1, 0x1E78, 0x3E55, 0x3E0F, 0x1E22, 
	0x1F10, 0x3F3D, 0x3F67, 0x1F4A, 0x3FD3, 0x1FFE, 0x1FA4, 0x3F89, 
	0x1680, 0x36AD, 0x36F7, 0x16DA, 0x3643, 0x166E, 0x1634, 0x3619, 
	0x372B, 0x1706, 0x175C, 0x3771, 0x17E8, 0x37C5, 0x379F, 0x17B2, 
	0x35FB, 0x15D6, 0x158C, 0x35A1, 0x1538, 0x3515, 0x354F, 0x1562, 
	0x1450, 0x347D, 0x3427, 0x140A, 0x3493, 0x14BE, 0x14E4, 0x34C9, 
	0x305B, 0x1076, 0x102C, 0x3001, 0x1098, 0x30B5, 0x30EF, 0x10C2, 
	0x11F0, 0x31DD, 0x3187, 0x11AA, 0x3133, 0x111E, 0x1144, 0x3169, 
	0x1320, 0x330D, 0x3357, 0x137A, 0x33E3, 0x13CE, 0x1394, 0x33B9, 
	0x328B, 0x12A6, 0x12FC, 0x32D1, 0x1248, 0x3265, 0x323F, 0x1212
	);
	
	public function __construct()
	{	
		$this->FHash = 0;
		$this->Check = '30AE';
	}
	
	public function Update($Msg, $Length)	
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 6)) & 0xFF];		
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0x3FFF;
		$this->FHash = $this->FHash ^ 0x3FFF;
		return sprintf('%04X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-14 GSM', 'Hashercrc14_gsm');


