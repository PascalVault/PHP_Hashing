<?php
//CRC-12 GSM
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class Hashercrc12_gsm extends HasherBase
{
	protected $FHash;

	protected $Table = array(
	0x0000, 0x0D31, 0x0753, 0x0A62, 0x0EA6, 0x0397, 0x09F5, 0x04C4, 
	0x007D, 0x0D4C, 0x072E, 0x0A1F, 0x0EDB, 0x03EA, 0x0988, 0x04B9, 
	0x00FA, 0x0DCB, 0x07A9, 0x0A98, 0x0E5C, 0x036D, 0x090F, 0x043E, 
	0x0087, 0x0DB6, 0x07D4, 0x0AE5, 0x0E21, 0x0310, 0x0972, 0x0443, 
	0x01F4, 0x0CC5, 0x06A7, 0x0B96, 0x0F52, 0x0263, 0x0801, 0x0530, 
	0x0189, 0x0CB8, 0x06DA, 0x0BEB, 0x0F2F, 0x021E, 0x087C, 0x054D, 
	0x010E, 0x0C3F, 0x065D, 0x0B6C, 0x0FA8, 0x0299, 0x08FB, 0x05CA, 
	0x0173, 0x0C42, 0x0620, 0x0B11, 0x0FD5, 0x02E4, 0x0886, 0x05B7, 
	0x03E8, 0x0ED9, 0x04BB, 0x098A, 0x0D4E, 0x007F, 0x0A1D, 0x072C, 
	0x0395, 0x0EA4, 0x04C6, 0x09F7, 0x0D33, 0x0002, 0x0A60, 0x0751, 
	0x0312, 0x0E23, 0x0441, 0x0970, 0x0DB4, 0x0085, 0x0AE7, 0x07D6, 
	0x036F, 0x0E5E, 0x043C, 0x090D, 0x0DC9, 0x00F8, 0x0A9A, 0x07AB, 
	0x021C, 0x0F2D, 0x054F, 0x087E, 0x0CBA, 0x018B, 0x0BE9, 0x06D8, 
	0x0261, 0x0F50, 0x0532, 0x0803, 0x0CC7, 0x01F6, 0x0B94, 0x06A5, 
	0x02E6, 0x0FD7, 0x05B5, 0x0884, 0x0C40, 0x0171, 0x0B13, 0x0622, 
	0x029B, 0x0FAA, 0x05C8, 0x08F9, 0x0C3D, 0x010C, 0x0B6E, 0x065F, 
	0x07D0, 0x0AE1, 0x0083, 0x0DB2, 0x0976, 0x0447, 0x0E25, 0x0314, 
	0x07AD, 0x0A9C, 0x00FE, 0x0DCF, 0x090B, 0x043A, 0x0E58, 0x0369, 
	0x072A, 0x0A1B, 0x0079, 0x0D48, 0x098C, 0x04BD, 0x0EDF, 0x03EE, 
	0x0757, 0x0A66, 0x0004, 0x0D35, 0x09F1, 0x04C0, 0x0EA2, 0x0393, 
	0x0624, 0x0B15, 0x0177, 0x0C46, 0x0882, 0x05B3, 0x0FD1, 0x02E0, 
	0x0659, 0x0B68, 0x010A, 0x0C3B, 0x08FF, 0x05CE, 0x0FAC, 0x029D, 
	0x06DE, 0x0BEF, 0x018D, 0x0CBC, 0x0878, 0x0549, 0x0F2B, 0x021A, 
	0x06A3, 0x0B92, 0x01F0, 0x0CC1, 0x0805, 0x0534, 0x0F56, 0x0267, 
	0x0438, 0x0909, 0x036B, 0x0E5A, 0x0A9E, 0x07AF, 0x0DCD, 0x00FC, 
	0x0445, 0x0974, 0x0316, 0x0E27, 0x0AE3, 0x07D2, 0x0DB0, 0x0081, 
	0x04C2, 0x09F3, 0x0391, 0x0EA0, 0x0A64, 0x0755, 0x0D37, 0x0006, 
	0x04BF, 0x098E, 0x03EC, 0x0EDD, 0x0A19, 0x0728, 0x0D4A, 0x007B, 
	0x05CC, 0x08FD, 0x029F, 0x0FAE, 0x0B6A, 0x065B, 0x0C39, 0x0108, 
	0x05B1, 0x0880, 0x02E2, 0x0FD3, 0x0B17, 0x0626, 0x0C44, 0x0175, 
	0x0536, 0x0807, 0x0265, 0x0F54, 0x0B90, 0x06A1, 0x0CC3, 0x01F2, 
	0x054B, 0x087A, 0x0218, 0x0F29, 0x0BED, 0x06DC, 0x0CBE, 0x018F
	);

	public function __construct()
	{	
		$this->FHash = 0;
		$this->Check = 'B34';
	}
	
	public function Update($Msg, $Length)	
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 4)) & 0xFF];
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0xFFF;
		$this->FHash = $this->FHash ^ 0xFFF;
		return sprintf('%03X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-12 GSM', 'Hashercrc12_gsm');


