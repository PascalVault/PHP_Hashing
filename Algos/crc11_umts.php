<?php
//CRC-11 umts
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC11_umts extends HasherBase
{
	protected $FHash;

	protected $Table = array(
	0x0000, 0x0307, 0x060E, 0x0509, 0x071B, 0x041C, 0x0115, 0x0212, 
	0x0531, 0x0636, 0x033F, 0x0038, 0x022A, 0x012D, 0x0424, 0x0723, 
	0x0165, 0x0262, 0x076B, 0x046C, 0x067E, 0x0579, 0x0070, 0x0377, 
	0x0454, 0x0753, 0x025A, 0x015D, 0x034F, 0x0048, 0x0541, 0x0646, 
	0x02CA, 0x01CD, 0x04C4, 0x07C3, 0x05D1, 0x06D6, 0x03DF, 0x00D8, 
	0x07FB, 0x04FC, 0x01F5, 0x02F2, 0x00E0, 0x03E7, 0x06EE, 0x05E9, 
	0x03AF, 0x00A8, 0x05A1, 0x06A6, 0x04B4, 0x07B3, 0x02BA, 0x01BD, 
	0x069E, 0x0599, 0x0090, 0x0397, 0x0185, 0x0282, 0x078B, 0x048C, 
	0x0594, 0x0693, 0x039A, 0x009D, 0x028F, 0x0188, 0x0481, 0x0786, 
	0x00A5, 0x03A2, 0x06AB, 0x05AC, 0x07BE, 0x04B9, 0x01B0, 0x02B7, 
	0x04F1, 0x07F6, 0x02FF, 0x01F8, 0x03EA, 0x00ED, 0x05E4, 0x06E3, 
	0x01C0, 0x02C7, 0x07CE, 0x04C9, 0x06DB, 0x05DC, 0x00D5, 0x03D2, 
	0x075E, 0x0459, 0x0150, 0x0257, 0x0045, 0x0342, 0x064B, 0x054C, 
	0x026F, 0x0168, 0x0461, 0x0766, 0x0574, 0x0673, 0x037A, 0x007D, 
	0x063B, 0x053C, 0x0035, 0x0332, 0x0120, 0x0227, 0x072E, 0x0429, 
	0x030A, 0x000D, 0x0504, 0x0603, 0x0411, 0x0716, 0x021F, 0x0118, 
	0x002F, 0x0328, 0x0621, 0x0526, 0x0734, 0x0433, 0x013A, 0x023D, 
	0x051E, 0x0619, 0x0310, 0x0017, 0x0205, 0x0102, 0x040B, 0x070C, 
	0x014A, 0x024D, 0x0744, 0x0443, 0x0651, 0x0556, 0x005F, 0x0358, 
	0x047B, 0x077C, 0x0275, 0x0172, 0x0360, 0x0067, 0x056E, 0x0669, 
	0x02E5, 0x01E2, 0x04EB, 0x07EC, 0x05FE, 0x06F9, 0x03F0, 0x00F7, 
	0x07D4, 0x04D3, 0x01DA, 0x02DD, 0x00CF, 0x03C8, 0x06C1, 0x05C6, 
	0x0380, 0x0087, 0x058E, 0x0689, 0x049B, 0x079C, 0x0295, 0x0192, 
	0x06B1, 0x05B6, 0x00BF, 0x03B8, 0x01AA, 0x02AD, 0x07A4, 0x04A3, 
	0x05BB, 0x06BC, 0x03B5, 0x00B2, 0x02A0, 0x01A7, 0x04AE, 0x07A9, 
	0x008A, 0x038D, 0x0684, 0x0583, 0x0791, 0x0496, 0x019F, 0x0298, 
	0x04DE, 0x07D9, 0x02D0, 0x01D7, 0x03C5, 0x00C2, 0x05CB, 0x06CC, 
	0x01EF, 0x02E8, 0x07E1, 0x04E6, 0x06F4, 0x05F3, 0x00FA, 0x03FD, 
	0x0771, 0x0476, 0x017F, 0x0278, 0x006A, 0x036D, 0x0664, 0x0563, 
	0x0240, 0x0147, 0x044E, 0x0749, 0x055B, 0x065C, 0x0355, 0x0052, 
	0x0614, 0x0513, 0x001A, 0x031D, 0x010F, 0x0208, 0x0701, 0x0406, 
	0x0325, 0x0022, 0x052B, 0x062C, 0x043E, 0x0739, 0x0230, 0x0137
	);
	
	public function __construct()
	{	
		$this->FHash = 0;
		$this->Check = '061';
	}
	
	public function Update($Msg, $Length)	
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 3)) & 0xFF];		
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0x7FF;
		
		return sprintf('%03X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-11 umts', 'HasherCRC11_umts');


