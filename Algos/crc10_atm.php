<?php
//CRC-10 ATM
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC10_atm extends HasherBase
{
	protected $FHash;

	protected $Table = array(
	0x0000, 0x0233, 0x0255, 0x0066, 0x0299, 0x00AA, 0x00CC, 0x02FF, 
	0x0301, 0x0132, 0x0154, 0x0367, 0x0198, 0x03AB, 0x03CD, 0x01FE, 
	0x0031, 0x0202, 0x0264, 0x0057, 0x02A8, 0x009B, 0x00FD, 0x02CE, 
	0x0330, 0x0103, 0x0165, 0x0356, 0x01A9, 0x039A, 0x03FC, 0x01CF, 
	0x0062, 0x0251, 0x0237, 0x0004, 0x02FB, 0x00C8, 0x00AE, 0x029D, 
	0x0363, 0x0150, 0x0136, 0x0305, 0x01FA, 0x03C9, 0x03AF, 0x019C, 
	0x0053, 0x0260, 0x0206, 0x0035, 0x02CA, 0x00F9, 0x009F, 0x02AC, 
	0x0352, 0x0161, 0x0107, 0x0334, 0x01CB, 0x03F8, 0x039E, 0x01AD, 
	0x00C4, 0x02F7, 0x0291, 0x00A2, 0x025D, 0x006E, 0x0008, 0x023B, 
	0x03C5, 0x01F6, 0x0190, 0x03A3, 0x015C, 0x036F, 0x0309, 0x013A, 
	0x00F5, 0x02C6, 0x02A0, 0x0093, 0x026C, 0x005F, 0x0039, 0x020A, 
	0x03F4, 0x01C7, 0x01A1, 0x0392, 0x016D, 0x035E, 0x0338, 0x010B, 
	0x00A6, 0x0295, 0x02F3, 0x00C0, 0x023F, 0x000C, 0x006A, 0x0259, 
	0x03A7, 0x0194, 0x01F2, 0x03C1, 0x013E, 0x030D, 0x036B, 0x0158, 
	0x0097, 0x02A4, 0x02C2, 0x00F1, 0x020E, 0x003D, 0x005B, 0x0268, 
	0x0396, 0x01A5, 0x01C3, 0x03F0, 0x010F, 0x033C, 0x035A, 0x0169, 
	0x0188, 0x03BB, 0x03DD, 0x01EE, 0x0311, 0x0122, 0x0144, 0x0377, 
	0x0289, 0x00BA, 0x00DC, 0x02EF, 0x0010, 0x0223, 0x0245, 0x0076, 
	0x01B9, 0x038A, 0x03EC, 0x01DF, 0x0320, 0x0113, 0x0175, 0x0346, 
	0x02B8, 0x008B, 0x00ED, 0x02DE, 0x0021, 0x0212, 0x0274, 0x0047, 
	0x01EA, 0x03D9, 0x03BF, 0x018C, 0x0373, 0x0140, 0x0126, 0x0315, 
	0x02EB, 0x00D8, 0x00BE, 0x028D, 0x0072, 0x0241, 0x0227, 0x0014, 
	0x01DB, 0x03E8, 0x038E, 0x01BD, 0x0342, 0x0171, 0x0117, 0x0324, 
	0x02DA, 0x00E9, 0x008F, 0x02BC, 0x0043, 0x0270, 0x0216, 0x0025, 
	0x014C, 0x037F, 0x0319, 0x012A, 0x03D5, 0x01E6, 0x0180, 0x03B3, 
	0x024D, 0x007E, 0x0018, 0x022B, 0x00D4, 0x02E7, 0x0281, 0x00B2, 
	0x017D, 0x034E, 0x0328, 0x011B, 0x03E4, 0x01D7, 0x01B1, 0x0382, 
	0x027C, 0x004F, 0x0029, 0x021A, 0x00E5, 0x02D6, 0x02B0, 0x0083, 
	0x012E, 0x031D, 0x037B, 0x0148, 0x03B7, 0x0184, 0x01E2, 0x03D1, 
	0x022F, 0x001C, 0x007A, 0x0249, 0x00B6, 0x0285, 0x02E3, 0x00D0, 
	0x011F, 0x032C, 0x034A, 0x0179, 0x0386, 0x01B5, 0x01D3, 0x03E0, 
	0x021E, 0x002D, 0x004B, 0x0278, 0x0087, 0x02B4, 0x02D2, 0x00E1
	);

	public function __construct()
	{	
		$this->FHash = 0;
		$this->Check = '199';
	}
	
	public function Update($Msg, $Length)	
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 2)) & 0xFF];
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0x3FF;
		return sprintf('%03X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-10 ATM', 'HasherCRC10_atm');


