<?php
//CRC-40 GSM
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC40_gsm extends HasherBase
{
	protected $FHash;

    protected $Table = array(
	0x0000000000000000, 0x0000000004820009, 0x0000000009040012, 0x000000000D86001B, 0x0000000012080024, 0x00000000168A002D, 0x000000001B0C0036, 0x000000001F8E003F,
	0x0000000024100048, 0x0000000020920041, 0x000000002D14005A, 0x0000000029960053, 0x000000003618006C, 0x00000000329A0065, 0x000000003F1C007E, 0x000000003B9E0077,
	0x0000000048200090, 0x000000004CA20099, 0x0000000041240082, 0x0000000045A6008B, 0x000000005A2800B4, 0x000000005EAA00BD, 0x00000000532C00A6, 0x0000000057AE00AF,
	0x000000006C3000D8, 0x0000000068B200D1, 0x00000000653400CA, 0x0000000061B600C3, 0x000000007E3800FC, 0x000000007ABA00F5, 0x00000000773C00EE, 0x0000000073BE00E7,
	0x0000000090400120, 0x0000000094C20129, 0x0000000099440132, 0x000000009DC6013B, 0x0000000082480104, 0x0000000086CA010D, 0x000000008B4C0116, 0x000000008FCE011F,
	0x00000000B4500168, 0x00000000B0D20161, 0x00000000BD54017A, 0x00000000B9D60173, 0x00000000A658014C, 0x00000000A2DA0145, 0x00000000AF5C015E, 0x00000000ABDE0157,
	0x00000000D86001B0, 0x00000000DCE201B9, 0x00000000D16401A2, 0x00000000D5E601AB, 0x00000000CA680194, 0x00000000CEEA019D, 0x00000000C36C0186, 0x00000000C7EE018F,
	0x00000000FC7001F8, 0x00000000F8F201F1, 0x00000000F57401EA, 0x00000000F1F601E3, 0x00000000EE7801DC, 0x00000000EAFA01D5, 0x00000000E77C01CE, 0x00000000E3FE01C7,
	0x0000000120800240, 0x0000000124020249, 0x0000000129840252, 0x000000012D06025B, 0x0000000132880264, 0x00000001360A026D, 0x000000013B8C0276, 0x000000013F0E027F,
	0x0000000104900208, 0x0000000100120201, 0x000000010D94021A, 0x0000000109160213, 0x000000011698022C, 0x00000001121A0225, 0x000000011F9C023E, 0x000000011B1E0237,
	0x0000000168A002D0, 0x000000016C2202D9, 0x0000000161A402C2, 0x00000001652602CB, 0x000000017AA802F4, 0x000000017E2A02FD, 0x0000000173AC02E6, 0x00000001772E02EF,
	0x000000014CB00298, 0x0000000148320291, 0x0000000145B4028A, 0x0000000141360283, 0x000000015EB802BC, 0x000000015A3A02B5, 0x0000000157BC02AE, 0x00000001533E02A7,
	0x00000001B0C00360, 0x00000001B4420369, 0x00000001B9C40372, 0x00000001BD46037B, 0x00000001A2C80344, 0x00000001A64A034D, 0x00000001ABCC0356, 0x00000001AF4E035F,
	0x0000000194D00328, 0x0000000190520321, 0x000000019DD4033A, 0x0000000199560333, 0x0000000186D8030C, 0x00000001825A0305, 0x000000018FDC031E, 0x000000018B5E0317,
	0x00000001F8E003F0, 0x00000001FC6203F9, 0x00000001F1E403E2, 0x00000001F56603EB, 0x00000001EAE803D4, 0x00000001EE6A03DD, 0x00000001E3EC03C6, 0x00000001E76E03CF,
	0x00000001DCF003B8, 0x00000001D87203B1, 0x00000001D5F403AA, 0x00000001D17603A3, 0x00000001CEF8039C, 0x00000001CA7A0395, 0x00000001C7FC038E, 0x00000001C37E0387,
	0x0000000241000480, 0x0000000245820489, 0x0000000248040492, 0x000000024C86049B, 0x00000002530804A4, 0x00000002578A04AD, 0x000000025A0C04B6, 0x000000025E8E04BF,
	0x00000002651004C8, 0x00000002619204C1, 0x000000026C1404DA, 0x00000002689604D3, 0x00000002771804EC, 0x00000002739A04E5, 0x000000027E1C04FE, 0x000000027A9E04F7,
	0x0000000209200410, 0x000000020DA20419, 0x0000000200240402, 0x0000000204A6040B, 0x000000021B280434, 0x000000021FAA043D, 0x00000002122C0426, 0x0000000216AE042F,
	0x000000022D300458, 0x0000000229B20451, 0x000000022434044A, 0x0000000220B60443, 0x000000023F38047C, 0x000000023BBA0475, 0x00000002363C046E, 0x0000000232BE0467,
	0x00000002D14005A0, 0x00000002D5C205A9, 0x00000002D84405B2, 0x00000002DCC605BB, 0x00000002C3480584, 0x00000002C7CA058D, 0x00000002CA4C0596, 0x00000002CECE059F,
	0x00000002F55005E8, 0x00000002F1D205E1, 0x00000002FC5405FA, 0x00000002F8D605F3, 0x00000002E75805CC, 0x00000002E3DA05C5, 0x00000002EE5C05DE, 0x00000002EADE05D7,
	0x0000000299600530, 0x000000029DE20539, 0x0000000290640522, 0x0000000294E6052B, 0x000000028B680514, 0x000000028FEA051D, 0x00000002826C0506, 0x0000000286EE050F,
	0x00000002BD700578, 0x00000002B9F20571, 0x00000002B474056A, 0x00000002B0F60563, 0x00000002AF78055C, 0x00000002ABFA0555, 0x00000002A67C054E, 0x00000002A2FE0547,
	0x00000003618006C0, 0x00000003650206C9, 0x00000003688406D2, 0x000000036C0606DB, 0x00000003738806E4, 0x00000003770A06ED, 0x000000037A8C06F6, 0x000000037E0E06FF,
	0x0000000345900688, 0x0000000341120681, 0x000000034C94069A, 0x0000000348160693, 0x00000003579806AC, 0x00000003531A06A5, 0x000000035E9C06BE, 0x000000035A1E06B7,
	0x0000000329A00650, 0x000000032D220659, 0x0000000320A40642, 0x000000032426064B, 0x000000033BA80674, 0x000000033F2A067D, 0x0000000332AC0666, 0x00000003362E066F,
	0x000000030DB00618, 0x0000000309320611, 0x0000000304B4060A, 0x0000000300360603, 0x000000031FB8063C, 0x000000031B3A0635, 0x0000000316BC062E, 0x00000003123E0627,
	0x00000003F1C007E0, 0x00000003F54207E9, 0x00000003F8C407F2, 0x00000003FC4607FB, 0x00000003E3C807C4, 0x00000003E74A07CD, 0x00000003EACC07D6, 0x00000003EE4E07DF,
	0x00000003D5D007A8, 0x00000003D15207A1, 0x00000003DCD407BA, 0x00000003D85607B3, 0x00000003C7D8078C, 0x00000003C35A0785, 0x00000003CEDC079E, 0x00000003CA5E0797,
	0x00000003B9E00770, 0x00000003BD620779, 0x00000003B0E40762, 0x00000003B466076B, 0x00000003ABE80754, 0x00000003AF6A075D, 0x00000003A2EC0746, 0x00000003A66E074F,
	0x000000039DF00738, 0x0000000399720731, 0x0000000394F4072A, 0x0000000390760723, 0x000000038FF8071C, 0x000000038B7A0715, 0x0000000386FC070E, 0x00000003827E0707
	);
	
	public function __construct()
	{	
		$this->FHash =  0;
		$this->Check = 'D4164FC646';
	}
	
	public function Update($Msg, $Length)
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 32)) & 0xFF];
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0xFFFFFFFFFF;
		$this->FHash = $this->FHash ^ 0xFFFFFFFFFF;
		return sprintf('%010X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-40 GSM', 'HasherCRC40_gsm');


