<?php
//CRC-15 MPT1327
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC15_MPT1327 extends HasherBase
{
	protected $FHash;

	protected $Table = array(
	0x0000, 0x6815, 0x383F, 0x502A, 0x707E, 0x186B, 0x4841, 0x2054, 
	0x08E9, 0x60FC, 0x30D6, 0x58C3, 0x7897, 0x1082, 0x40A8, 0x28BD, 
	0x11D2, 0x79C7, 0x29ED, 0x41F8, 0x61AC, 0x09B9, 0x5993, 0x3186, 
	0x193B, 0x712E, 0x2104, 0x4911, 0x6945, 0x0150, 0x517A, 0x396F, 
	0x23A4, 0x4BB1, 0x1B9B, 0x738E, 0x53DA, 0x3BCF, 0x6BE5, 0x03F0, 
	0x2B4D, 0x4358, 0x1372, 0x7B67, 0x5B33, 0x3326, 0x630C, 0x0B19, 
	0x3276, 0x5A63, 0x0A49, 0x625C, 0x4208, 0x2A1D, 0x7A37, 0x1222, 
	0x3A9F, 0x528A, 0x02A0, 0x6AB5, 0x4AE1, 0x22F4, 0x72DE, 0x1ACB, 
	0x4748, 0x2F5D, 0x7F77, 0x1762, 0x3736, 0x5F23, 0x0F09, 0x671C, 
	0x4FA1, 0x27B4, 0x779E, 0x1F8B, 0x3FDF, 0x57CA, 0x07E0, 0x6FF5, 
	0x569A, 0x3E8F, 0x6EA5, 0x06B0, 0x26E4, 0x4EF1, 0x1EDB, 0x76CE, 
	0x5E73, 0x3666, 0x664C, 0x0E59, 0x2E0D, 0x4618, 0x1632, 0x7E27, 
	0x64EC, 0x0CF9, 0x5CD3, 0x34C6, 0x1492, 0x7C87, 0x2CAD, 0x44B8, 
	0x6C05, 0x0410, 0x543A, 0x3C2F, 0x1C7B, 0x746E, 0x2444, 0x4C51, 
	0x753E, 0x1D2B, 0x4D01, 0x2514, 0x0540, 0x6D55, 0x3D7F, 0x556A, 
	0x7DD7, 0x15C2, 0x45E8, 0x2DFD, 0x0DA9, 0x65BC, 0x3596, 0x5D83, 
	0x6685, 0x0E90, 0x5EBA, 0x36AF, 0x16FB, 0x7EEE, 0x2EC4, 0x46D1, 
	0x6E6C, 0x0679, 0x5653, 0x3E46, 0x1E12, 0x7607, 0x262D, 0x4E38, 
	0x7757, 0x1F42, 0x4F68, 0x277D, 0x0729, 0x6F3C, 0x3F16, 0x5703, 
	0x7FBE, 0x17AB, 0x4781, 0x2F94, 0x0FC0, 0x67D5, 0x37FF, 0x5FEA, 
	0x4521, 0x2D34, 0x7D1E, 0x150B, 0x355F, 0x5D4A, 0x0D60, 0x6575, 
	0x4DC8, 0x25DD, 0x75F7, 0x1DE2, 0x3DB6, 0x55A3, 0x0589, 0x6D9C, 
	0x54F3, 0x3CE6, 0x6CCC, 0x04D9, 0x248D, 0x4C98, 0x1CB2, 0x74A7, 
	0x5C1A, 0x340F, 0x6425, 0x0C30, 0x2C64, 0x4471, 0x145B, 0x7C4E, 
	0x21CD, 0x49D8, 0x19F2, 0x71E7, 0x51B3, 0x39A6, 0x698C, 0x0199, 
	0x2924, 0x4131, 0x111B, 0x790E, 0x595A, 0x314F, 0x6165, 0x0970, 
	0x301F, 0x580A, 0x0820, 0x6035, 0x4061, 0x2874, 0x785E, 0x104B, 
	0x38F6, 0x50E3, 0x00C9, 0x68DC, 0x4888, 0x209D, 0x70B7, 0x18A2, 
	0x0269, 0x6A7C, 0x3A56, 0x5243, 0x7217, 0x1A02, 0x4A28, 0x223D, 
	0x0A80, 0x6295, 0x32BF, 0x5AAA, 0x7AFE, 0x12EB, 0x42C1, 0x2AD4, 
	0x13BB, 0x7BAE, 0x2B84, 0x4391, 0x63C5, 0x0BD0, 0x5BFA, 0x33EF, 
	0x1B52, 0x7347, 0x236D, 0x4B78, 0x6B2C, 0x0339, 0x5313, 0x3B06
	);

	public function __construct()
	{	
		$this->FHash = 0;
		$this->Check = '2566';
	}
	
	public function Update($Msg, $Length)	
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 7)) & 0xFF];
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0x7FFF;
		$this->FHash = $this->FHash ^ 1;
		return sprintf('%04X', $this->FHash);
	}
	}

$HasherList->RegisterHasher('CRC-15 MPT1327', 'HasherCRC15_MPT1327');


