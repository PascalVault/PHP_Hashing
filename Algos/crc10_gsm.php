<?php
//CRC-10 gsm
//Author: domasz
//Version: 0.1 (2022-11-17)
//Licence: MIT

require_once 'HasherBase.php';

class HasherCRC10_gsm extends HasherBase
{
	protected $FHash;

	protected $Table = array(
	0x0000, 0x0175, 0x02EA, 0x039F, 0x00A1, 0x01D4, 0x024B, 0x033E, 
	0x0142, 0x0037, 0x03A8, 0x02DD, 0x01E3, 0x0096, 0x0309, 0x027C, 
	0x0284, 0x03F1, 0x006E, 0x011B, 0x0225, 0x0350, 0x00CF, 0x01BA, 
	0x03C6, 0x02B3, 0x012C, 0x0059, 0x0367, 0x0212, 0x018D, 0x00F8, 
	0x007D, 0x0108, 0x0297, 0x03E2, 0x00DC, 0x01A9, 0x0236, 0x0343, 
	0x013F, 0x004A, 0x03D5, 0x02A0, 0x019E, 0x00EB, 0x0374, 0x0201, 
	0x02F9, 0x038C, 0x0013, 0x0166, 0x0258, 0x032D, 0x00B2, 0x01C7, 
	0x03BB, 0x02CE, 0x0151, 0x0024, 0x031A, 0x026F, 0x01F0, 0x0085, 
	0x00FA, 0x018F, 0x0210, 0x0365, 0x005B, 0x012E, 0x02B1, 0x03C4, 
	0x01B8, 0x00CD, 0x0352, 0x0227, 0x0119, 0x006C, 0x03F3, 0x0286, 
	0x027E, 0x030B, 0x0094, 0x01E1, 0x02DF, 0x03AA, 0x0035, 0x0140, 
	0x033C, 0x0249, 0x01D6, 0x00A3, 0x039D, 0x02E8, 0x0177, 0x0002, 
	0x0087, 0x01F2, 0x026D, 0x0318, 0x0026, 0x0153, 0x02CC, 0x03B9, 
	0x01C5, 0x00B0, 0x032F, 0x025A, 0x0164, 0x0011, 0x038E, 0x02FB, 
	0x0203, 0x0376, 0x00E9, 0x019C, 0x02A2, 0x03D7, 0x0048, 0x013D, 
	0x0341, 0x0234, 0x01AB, 0x00DE, 0x03E0, 0x0295, 0x010A, 0x007F, 
	0x01F4, 0x0081, 0x031E, 0x026B, 0x0155, 0x0020, 0x03BF, 0x02CA, 
	0x00B6, 0x01C3, 0x025C, 0x0329, 0x0017, 0x0162, 0x02FD, 0x0388, 
	0x0370, 0x0205, 0x019A, 0x00EF, 0x03D1, 0x02A4, 0x013B, 0x004E, 
	0x0232, 0x0347, 0x00D8, 0x01AD, 0x0293, 0x03E6, 0x0079, 0x010C, 
	0x0189, 0x00FC, 0x0363, 0x0216, 0x0128, 0x005D, 0x03C2, 0x02B7, 
	0x00CB, 0x01BE, 0x0221, 0x0354, 0x006A, 0x011F, 0x0280, 0x03F5, 
	0x030D, 0x0278, 0x01E7, 0x0092, 0x03AC, 0x02D9, 0x0146, 0x0033, 
	0x024F, 0x033A, 0x00A5, 0x01D0, 0x02EE, 0x039B, 0x0004, 0x0171, 
	0x010E, 0x007B, 0x03E4, 0x0291, 0x01AF, 0x00DA, 0x0345, 0x0230, 
	0x004C, 0x0139, 0x02A6, 0x03D3, 0x00ED, 0x0198, 0x0207, 0x0372, 
	0x038A, 0x02FF, 0x0160, 0x0015, 0x032B, 0x025E, 0x01C1, 0x00B4, 
	0x02C8, 0x03BD, 0x0022, 0x0157, 0x0269, 0x031C, 0x0083, 0x01F6, 
	0x0173, 0x0006, 0x0399, 0x02EC, 0x01D2, 0x00A7, 0x0338, 0x024D, 
	0x0031, 0x0144, 0x02DB, 0x03AE, 0x0090, 0x01E5, 0x027A, 0x030F, 
	0x03F7, 0x0282, 0x011D, 0x0068, 0x0356, 0x0223, 0x01BC, 0x00C9, 
	0x02B5, 0x03C0, 0x005F, 0x012A, 0x0214, 0x0361, 0x00FE, 0x018B
	);
	
	public function __construct()
	{	
		$this->FHash = 0;
		$this->Check = '12A';
	}
	
	public function Update($Msg, $Length)	
	{
		for ($i=0; $i<$Length; $i++)
		{
			$this->FHash = ($this->FHash << 8) ^ $this->Table[(ord($Msg[$i]) ^ ($this->FHash >> 2)) & 0xFF];		
		}   
	}
	
	public function Finish()
	{
		$this->FHash = $this->FHash & 0x3FF;
		$this->FHash = $this->FHash ^ 0x3FF;
		return sprintf('%03X', $this->FHash);
	}
}

$HasherList->RegisterHasher('CRC-10 gsm', 'HasherCRC10_gsm');


